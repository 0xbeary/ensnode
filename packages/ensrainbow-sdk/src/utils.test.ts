import { describe, expect, it } from "vitest";
import { InvalidLabelhashError, parseEncodedLabelhash, parseLabelhash } from "./utils";

describe("parseLabelhash", () => {
  it("should normalize a valid labelhash", () => {
    expect(parseLabelhash("0000000000000000000000000000000000000000000000000000000000000000")).toBe(
      "0x0000000000000000000000000000000000000000000000000000000000000000",
    );

    expect(
      parseLabelhash("0x0000000000000000000000000000000000000000000000000000000000000000"),
    ).toBe("0x0000000000000000000000000000000000000000000000000000000000000000");

    expect(parseLabelhash("000000000000000000000000000000000000000000000000000000000000000")).toBe(
      "0x0000000000000000000000000000000000000000000000000000000000000000",
    );

    expect(
      parseLabelhash("0x000000000000000000000000000000000000000000000000000000000000000"),
    ).toBe("0x0000000000000000000000000000000000000000000000000000000000000000");

    expect(parseLabelhash("A000000000000000000000000000000000000000000000000000000000000000")).toBe(
      "0xa000000000000000000000000000000000000000000000000000000000000000",
    );

    expect(parseLabelhash("A00000000000000000000000000000000000000000000000000000000000000")).toBe(
      "0x0a00000000000000000000000000000000000000000000000000000000000000",
    );
  });

  it("should throw for invalid labelhash", () => {
    // Invalid characters
    expect(() =>
      parseLabelhash("0xG000000000000000000000000000000000000000000000000000000000000000"),
    ).toThrow(InvalidLabelhashError);

    // Too short
    expect(() => parseLabelhash("0x00000")).toThrow(InvalidLabelhashError);

    // Too long
    expect(() =>
      parseLabelhash("0x00000000000000000000000000000000000000000000000000000000000000000"),
    ).toThrow(InvalidLabelhashError);
  });
});

describe("parseEncodedLabelhash", () => {
  it("should normalize a valid encoded labelhash", () => {
    expect(
      parseEncodedLabelhash("[0000000000000000000000000000000000000000000000000000000000000000]"),
    ).toBe("0x0000000000000000000000000000000000000000000000000000000000000000");

    expect(
      parseEncodedLabelhash("[0x0000000000000000000000000000000000000000000000000000000000000000]"),
    ).toBe("0x0000000000000000000000000000000000000000000000000000000000000000");

    expect(
      parseEncodedLabelhash("[000000000000000000000000000000000000000000000000000000000000000]"),
    ).toBe("0x0000000000000000000000000000000000000000000000000000000000000000");

    expect(
      parseEncodedLabelhash("[0x000000000000000000000000000000000000000000000000000000000000000]"),
    ).toBe("0x0000000000000000000000000000000000000000000000000000000000000000");

    expect(
      parseEncodedLabelhash("[A000000000000000000000000000000000000000000000000000000000000000]"),
    ).toBe("0xa000000000000000000000000000000000000000000000000000000000000000");

    expect(
      parseEncodedLabelhash("[A00000000000000000000000000000000000000000000000000000000000000]"),
    ).toBe("0x0a00000000000000000000000000000000000000000000000000000000000000");
  });

  it("should throw for invalid encoded labelhash", () => {
    // Not enclosed in brackets
    expect(() =>
      parseEncodedLabelhash("0000000000000000000000000000000000000000000000000000000000000000"),
    ).toThrow(InvalidLabelhashError);
    expect(() =>
      parseEncodedLabelhash("[0000000000000000000000000000000000000000000000000000000000000000"),
    ).toThrow(InvalidLabelhashError);
    expect(() =>
      parseEncodedLabelhash("0000000000000000000000000000000000000000000000000000000000000000]"),
    ).toThrow(InvalidLabelhashError);

    expect(() =>
      parseEncodedLabelhash("[00000000000000000000000000000000000000000000000000000000000000]"),
    ).toThrow(InvalidLabelhashError);
    expect(() =>
      parseEncodedLabelhash("[00000000000000000000000000000000000000000000000000000000000000000]"),
    ).toThrow(InvalidLabelhashError);

    expect(() =>
      parseEncodedLabelhash("[0X0000000000000000000000000000000000000000000000000000000000000000]"),
    ).toThrow(InvalidLabelhashError);

    // Invalid content
    expect(() => parseEncodedLabelhash("[00000]")).toThrow(InvalidLabelhashError);
    expect(() =>
      parseEncodedLabelhash("[0xG000000000000000000000000000000000000000000000000000000000000000]"),
    ).toThrow(InvalidLabelhashError);
  });
});
